"use client";

import SubmitBtn from "@/components/Buttons/submit";
import TextInput from "@/components/Inputs/text";
import Danger from "@/components/Alerts/danger";
import Success from "@/components/Alerts/success";
import Spinner from "@/components/Loaders/spinner";

import Link from "next/link";

import "@/styles/restore-password.scss";

import { useRouter } from "next/navigation";

import PageHeader from "@/components/auth/page-header";

import { useUserStore } from "@/providers/user";

import { useEffect, useRef } from "react";

import { useVisibility } from "@/hooks/useVisibility";

function ForgotPassword() {
  const { forgotPassword, error, loading, message } = useUserStore(
    (state) => state
  );
  const router = useRouter();

  
  const {
    isDangerAlertVisible,
    setDangerAlertVisibility,
    isSuccessAlertVisible,
  } = useVisibility();

  const emailRef = useRef<HTMLInputElement | null>(null);




  return (
    <main className="flex flex-col justify-center items-center restore-password ">
      <div className="flex flex-col items-center">
        <svg
          width="72"
          height="72"
          viewBox="0 0 72 72"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <circle opacity="0.48" cx="36" cy="36" r="36" fill="#EADFFC" />
          <circle opacity="0.64" cx="36" cy="36" r="24" fill="#D5C0F8" />
          <path
            d="M39.5 31.5L43 28M45 26L43 28L45 26ZM35.39 35.61C35.9064 36.1195 36.3168 36.726 36.5978 37.3948C36.8787 38.0635 37.0246 38.7813 37.0271 39.5066C37.0295 40.232 36.8884 40.9507 36.6119 41.6213C36.3355 42.2919 35.9291 42.9012 35.4162 43.4141C34.9033 43.9271 34.294 44.3334 33.6233 44.6099C32.9527 44.8864 32.234 45.0275 31.5087 45.025C30.7833 45.0226 30.0656 44.8767 29.3968 44.5958C28.7281 44.3148 28.1215 43.9043 27.612 43.388C26.6102 42.3507 26.0558 40.9614 26.0683 39.5193C26.0809 38.0772 26.6593 36.6977 27.679 35.678C28.6988 34.6583 30.0782 34.0798 31.5203 34.0673C32.9624 34.0548 34.3517 34.6091 35.389 35.611L35.39 35.61ZM35.39 35.61L39.5 31.5L35.39 35.61ZM39.5 31.5L42.5 34.5L46 31L43 28L39.5 31.5Z"
            stroke="#7356C0"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          />
        </svg>

        <PageHeader
          header="Forgot your Password?"
          subheader="No worries, weâ€™ll send you reset Instructions<"
        />

        <form
          onSubmit={(event) => {
            event.preventDefault();
            const email = emailRef?.current?.value || "";
            forgotPassword(email, router);
          }}
        >
          <div className="form-group">
            <TextInput
              label="Email"
              ref={(el) => {
                emailRef.current = el;
              }}
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
              >
                <mask id="path-1-inside-1_3112_815" fill="white">
                  <path d="M14.1667 17.7083H5.83334C2.79167 17.7083 1.04167 15.9583 1.04167 12.9167V7.08333C1.04167 4.04166 2.79167 2.29166 5.83334 2.29166H14.1667C17.2083 2.29166 18.9583 4.04166 18.9583 7.08333V12.9167C18.9583 15.9583 17.2083 17.7083 14.1667 17.7083ZM5.83334 3.54166C3.45001 3.54166 2.29167 4.7 2.29167 7.08333V12.9167C2.29167 15.3 3.45001 16.4583 5.83334 16.4583H14.1667C16.55 16.4583 17.7083 15.3 17.7083 12.9167V7.08333C17.7083 4.7 16.55 3.54166 14.1667 3.54166H5.83334Z" />
                </mask>
                <path
                  d="M14.1667 16.2083H5.83334V19.2083H14.1667V16.2083ZM5.83334 16.2083C4.59723 16.2083 3.82296 15.8579 3.35754 15.3925C2.89212 14.927 2.54167 14.1528 2.54167 12.9167H-0.458328C-0.458328 14.7222 0.0662264 16.3438 1.23622 17.5138C2.40621 18.6838 4.02778 19.2083 5.83334 19.2083V16.2083ZM2.54167 12.9167V7.08333H-0.458328V12.9167H2.54167ZM2.54167 7.08333C2.54167 5.84723 2.89212 5.07296 3.35754 4.60753C3.82296 4.14211 4.59723 3.79166 5.83334 3.79166V0.791664C4.02778 0.791664 2.40621 1.31622 1.23622 2.48621C0.0662264 3.65621 -0.458328 5.27777 -0.458328 7.08333H2.54167ZM5.83334 3.79166H14.1667V0.791664H5.83334V3.79166ZM14.1667 3.79166C15.4028 3.79166 16.177 4.14211 16.6425 4.60753C17.1079 5.07296 17.4583 5.84723 17.4583 7.08333H20.4583C20.4583 5.27777 19.9338 3.65621 18.7638 2.48621C17.5938 1.31622 15.9722 0.791664 14.1667 0.791664V3.79166ZM17.4583 7.08333V12.9167H20.4583V7.08333H17.4583ZM17.4583 12.9167C17.4583 14.1528 17.1079 14.927 16.6425 15.3925C16.177 15.8579 15.4028 16.2083 14.1667 16.2083V19.2083C15.9722 19.2083 17.5938 18.6838 18.7638 17.5138C19.9338 16.3438 20.4583 14.7222 20.4583 12.9167H17.4583ZM5.83334 2.04166C4.4212 2.04166 3.08143 2.38475 2.1081 3.35809C1.13476 4.33143 0.791672 5.6712 0.791672 7.08333H3.79167C3.79167 6.11213 4.02775 5.68107 4.22942 5.47941C4.43108 5.27775 4.86214 5.04166 5.83334 5.04166V2.04166ZM0.791672 7.08333V12.9167H3.79167V7.08333H0.791672ZM0.791672 12.9167C0.791672 14.3288 1.13476 15.6686 2.1081 16.6419C3.08143 17.6152 4.4212 17.9583 5.83334 17.9583V14.9583C4.86214 14.9583 4.43108 14.7222 4.22942 14.5206C4.02775 14.3189 3.79167 13.8879 3.79167 12.9167H0.791672ZM5.83334 17.9583H14.1667V14.9583H5.83334V17.9583ZM14.1667 17.9583C15.5788 17.9583 16.9186 17.6152 17.8919 16.6419C18.8653 15.6686 19.2083 14.3288 19.2083 12.9167H16.2083C16.2083 13.8879 15.9723 14.3189 15.7706 14.5206C15.5689 14.7222 15.1379 14.9583 14.1667 14.9583V17.9583ZM19.2083 12.9167V7.08333H16.2083V12.9167H19.2083ZM19.2083 7.08333C19.2083 5.6712 18.8653 4.33143 17.8919 3.35809C16.9186 2.38475 15.5788 2.04166 14.1667 2.04166V5.04166C15.1379 5.04166 15.5689 5.27775 15.7706 5.47941C15.9723 5.68107 16.2083 6.11213 16.2083 7.08333H19.2083ZM14.1667 2.04166H5.83334V5.04166H14.1667V2.04166Z"
                  fill="#8F9BB3"
                  mask="url(#path-1-inside-1_3112_815)"
                />
                <mask id="path-3-inside-2_3112_815" fill="white">
                  <path d="M9.99981 10.725C9.29981 10.725 8.59148 10.5083 8.04981 10.0666L5.44148 7.98331C5.17481 7.76664 5.12481 7.37497 5.34148 7.10831C5.55815 6.84164 5.94982 6.79164 6.21648 7.00831L8.82481 9.09165C9.45814 9.59998 10.5331 9.59998 11.1665 9.09165L13.7748 7.00831C14.0415 6.79164 14.4415 6.83331 14.6498 7.10831C14.8665 7.37497 14.8248 7.77498 14.5498 7.98331L11.9415 10.0666C11.4081 10.5083 10.6998 10.725 9.99981 10.725Z" />
                </mask>
                <path
                  d="M8.04981 10.0666L8.99772 8.90412L8.99185 8.89933L8.98594 8.89461L8.04981 10.0666ZM5.44148 7.98331L4.49555 9.14752L4.50535 9.15534L5.44148 7.98331ZM6.21648 7.00831L5.27056 8.17252L5.28035 8.18034L6.21648 7.00831ZM8.82481 9.09165L9.76373 7.92184L9.76094 7.91961L8.82481 9.09165ZM11.1665 9.09165L10.2303 7.91961L10.2276 7.92185L11.1665 9.09165ZM13.7748 7.00831L14.711 8.18039L14.7207 8.17248L13.7748 7.00831ZM14.6498 7.10831L13.4542 8.01409L13.4696 8.03441L13.4856 8.0542L14.6498 7.10831ZM14.5498 7.98331L13.644 6.78767L13.6287 6.79928L13.6137 6.81128L14.5498 7.98331ZM11.9415 10.0666L11.0054 8.89461L10.995 8.90289L10.9848 8.91136L11.9415 10.0666ZM9.99981 9.22497C9.59244 9.22497 9.23347 9.09635 8.99772 8.90412L7.10191 11.2292C7.94949 11.9203 9.00718 12.225 9.99981 12.225V9.22497ZM8.98594 8.89461L6.3776 6.81128L4.50535 9.15534L7.11368 11.2387L8.98594 8.89461ZM6.38736 6.81914C6.73096 7.09831 6.83756 7.6457 6.50565 8.0542L4.17731 6.16242C3.41207 7.10425 3.61866 8.43498 4.49559 9.14748L6.38736 6.81914ZM6.50565 8.0542C6.22648 8.39779 5.67909 8.50439 5.27059 8.17248L7.16237 5.84414C6.22054 5.0789 4.88981 5.28549 4.17731 6.16242L6.50565 8.0542ZM5.28035 8.18034L7.88868 10.2637L9.76094 7.91961L7.15261 5.83628L5.28035 8.18034ZM7.88589 10.2614C8.51657 10.7676 9.29383 10.9729 9.99564 10.9729C10.6975 10.9729 11.4747 10.7676 12.1054 10.2614L10.2276 7.92185C10.23 7.91991 10.2131 7.93374 10.1677 7.94817C10.1225 7.96256 10.0629 7.9729 9.99564 7.9729C9.92838 7.9729 9.86879 7.96256 9.82355 7.94817C9.77817 7.93374 9.76132 7.91991 9.76373 7.92185L7.88589 10.2614ZM12.1026 10.2637L14.7109 8.18035L12.8387 5.83628L10.2303 7.91961L12.1026 10.2637ZM14.7207 8.17248C14.35 8.47364 13.7745 8.43687 13.4542 8.01409L15.8455 6.20252C15.1085 5.22975 13.7329 5.10965 12.8289 5.84414L14.7207 8.17248ZM13.4856 8.0542C13.1845 7.68355 13.2213 7.10796 13.644 6.78767L15.4556 9.17895C16.4284 8.442 16.5485 7.0664 15.814 6.16242L13.4856 8.0542ZM13.6137 6.81128L11.0054 8.89461L12.8776 11.2387L15.4859 9.15534L13.6137 6.81128ZM10.9848 8.91136C10.7629 9.0951 10.4098 9.22497 9.99981 9.22497V12.225C10.9898 12.225 12.0534 11.9215 12.8982 11.2219L10.9848 8.91136Z"
                  fill="#8F9BB3"
                  mask="url(#path-3-inside-2_3112_815)"
                />
              </svg>
            </TextInput>
          </div>
          <div className="form-group">
            <SubmitBtn label="Reset Password" />
          </div>

          <Link
            href="/login"
            className="flex justify-center items-center back-btn"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
            >
              <path
                d="M9.57 5.92999L3.5 12L9.57 18.07"
                stroke="#8F9BB3"
                strokeWidth="1.5"
                strokeMiterlimit="10"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
              <path
                d="M20.5 12H3.66998"
                stroke="#8F9BB3"
                strokeWidth="1.5"
                strokeMiterlimit="10"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
            </svg>
            Back to login
          </Link>
        </form>
      </div>

      {isSuccessAlertVisible ? (
        <div className="fixed bottom-0 w-screen flex justify-center">
          <Success message={message!} />
        </div>
      ) : null}
      {isDangerAlertVisible ? (
        <div className="fixed bottom-0 w-screen flex justify-center">
          <Danger
            message={error?.message || ""}
            click={() => {
              setDangerAlertVisibility(false);
            }}
          />
        </div>
      ) : null}
      {loading ? <Spinner /> : null}
    </main>
  );
}

export default ForgotPassword;
